<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fade Clock</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="iPad Clock">
    <link rel="apple-touch-icon" href="icon.png">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/nosleep/0.12.0/NoSleep.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700&display=swap');

        body {
            background-color: #000000;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            font-family: "Nanum Gothic", -apple-system, sans-serif;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }

        /* --- 1. 페이드 애니메이션 정의  --- */
        @keyframes fadeInEffect {
            0% { 
                opacity: 0.2; 
                transform: translateY(5px); /* 살짝 아래에서 올라오는 느낌 */
            }
            100% { 
                opacity: 1; 
                transform: translateY(0); 
            }
     }
         
         .fade-animate {
             animation: fadeInEffect 0.4s ease-out forwards;
         }
 
         /* --- 2. 배경 (크로스페이드용) --- */
         #crossfade-bg {
             position: absolute;
             top: 50%; left: 50%;
             width: 800px; height: 800px;
             transform: translate(-50%, -50%);
             z-index: 1;
             opacity: 0.6; /* 전체 투명도 유지 */
             transform-origin: center;
         }
         
         .bg-layer {
             position: absolute;
             top: 0; left: 0;
             width: 100%; height: 100%;
             opacity: 0; /* 기본적으로 숨김 */
             transition: opacity 5s ease; /* 불투명도 변경 시 부드럽게 전환 */
         }
         
-        /* 오전 테마 */
-        #bg-am .petal {
-            background: radial-gradient(circle, rgba(103, 178, 216, 0.4) 0%, rgba(103, 178, 216, 0) 70%);
-        }
-        /* 오후 테마 */
-        #bg-pm .petal {
-            background: radial-gradient(circle, rgba(255, 147, 126, 0.4) 0%, rgba(255, 147, 126, 0) 70%);
-        }
-        
         .petal {
             position: absolute;
             top: 0; left: 0;
             width: 100%; height: 100%;
             border-radius: 50%;
             mix-blend-mode: screen;
             transform-origin: center;
+            background: radial-gradient(circle, rgba(103, 178, 216, 0.4) 0%, rgba(103, 178, 216, 0) 70%);
         }
 
         /* --- 3. 시계 UI --- */
         #clock-wrapper {
             position: absolute;
             top: 50%; left: 50%;
             transform: translate(-50%, -50%);
             display: flex;
             flex-direction: column;
             align-items: center;
             white-space: nowrap;
             z-index: 10;
         }
 
         #date-display {
             color: #dddddd;
             font-size: 30px; font-weight: 700;
             margin-bottom: 20px;
             letter-spacing: 1px;
             text-shadow: 0 2px 5px rgba(0,0,0,0.8);
         }
 
         .clock-container {
             display: flex;
             align-items: center;
@@ -219,94 +211,145 @@
         <button id="wake-btn" onclick="toggleNoSleep()">화면 켜짐 유지 (OFF)</button>
         <button id="close-btn" onclick="toggleMenu()">닫기</button>
     </div>
 
     <script>
         if ('serviceWorker' in navigator) {
             window.addEventListener('load', () => navigator.serviceWorker.register('sw.js').catch(e => console.log(e)));
         }
 
         // --- 요소 업데이트 헬퍼 함수 (페이드 효과용) ---
         function updateElementWithFade(elementId, newValue) {
             const el = document.getElementById(elementId);
             if (!el) return;
 
             // 값이 다를 때만 업데이트하고 애니메이션 실행
             if (el.innerText !== newValue) {
                 el.innerText = newValue;
                 
                 // 애니메이션 리셋 트릭 (클래스 뺐다 끼우기)
                 el.classList.remove('fade-animate');
                 void el.offsetWidth; // 리플로우 강제 (중요: 브라우저가 변경사항을 인지하게 함)
                 el.classList.add('fade-animate');
             }
         }
 
+        const hourThemes = [
+            '103,178,216', // 0
+            '96,164,209',
+            '88,149,202',
+            '83,140,195',
+            '93,131,189',
+            '115,125,183',
+            '146,124,182',
+            '176,128,184',
+            '201,132,183',
+            '216,135,177',
+            '225,136,168',
+            '232,136,157',
+            '238,136,142',
+            '241,140,125',
+            '241,150,109',
+            '236,163,101',
+            '224,172,103',
+            '201,177,115',
+            '168,178,135',
+            '131,176,158',
+            '103,170,176',
+            '92,156,185',
+            '88,142,189',
+            '91,133,190'
+        ];
+
         const dayNames = ['일요일', '월요일', '화요일', '수요일', '목요일', '금요일', '토요일'];
+        let lastHour = -1;
+        let activeBgId = 'bg-am';
+
+        function setLayerGradient(layer, color) {
+            if (!layer) return;
+            const gradient = `radial-gradient(circle, rgba(${color}, 0.4) 0%, rgba(${color}, 0) 70%)`;
+            layer.querySelectorAll('.petal').forEach(petal => {
+                petal.style.background = gradient;
+            });
+        }
+
+        function applyHourTheme(hour, ampmAm, ampmPm) {
+            const color = hourThemes[hour] || hourThemes[0];
+            const nextLayerId = activeBgId === 'bg-am' ? 'bg-pm' : 'bg-am';
+            const nextLayer = document.getElementById(nextLayerId);
+            const currentLayer = document.getElementById(activeBgId);
+
+            setLayerGradient(nextLayer, color);
+
+            if (nextLayer) nextLayer.style.opacity = '1';
+            if (currentLayer) currentLayer.style.opacity = '0';
+            activeBgId = nextLayerId;
+
+            const textColor = `rgb(${color})`;
+            if (ampmAm) ampmAm.style.color = textColor;
+            if (ampmPm) ampmPm.style.color = textColor;
+        }
 
 function updateClock() {
     const now = new Date();
-    
+
     const year = now.getFullYear();
     const month = String(now.getMonth() + 1).padStart(2, '0');
     const date = String(now.getDate()).padStart(2, '0');
     const day = dayNames[now.getDay()];
-    
+
     const dateDisplay = document.getElementById('date-display');
     if(dateDisplay) dateDisplay.innerText = `${year}. ${month}. ${date} ${day}`;
 
-    let h = now.getHours();
+    const hour24 = now.getHours();
+    let h = hour24;
     const m = String(now.getMinutes()).padStart(2, '0');
     const s = String(now.getSeconds()).padStart(2, '0');
-    
+
     // --- AM/PM 및 크로스페이드 로직 ---
-    const ampmElement = document.getElementById('ampm');
-    const bgAm = document.getElementById('bg-am');
-    const bgPm = document.getElementById('bg-pm');
-    const ampmAm = document.getElementById('ampm-am'); 
-    const ampmPm = document.getElementById('ampm-pm'); 
+    const ampmAm = document.getElementById('ampm-am');
+    const ampmPm = document.getElementById('ampm-pm');
+
+    if (hour24 !== lastHour) {
+        applyHourTheme(hour24, ampmAm, ampmPm);
+        lastHour = hour24;
+    }
 
     if (h >= 12) {
             // 오후 시간
-            if (bgPm) bgPm.style.opacity = '1';
-            if (bgAm) bgAm.style.opacity = '0';
-            
             if (ampmPm) ampmPm.style.opacity = '1'; // 오후 글자 나타남
             if (ampmAm) ampmAm.style.opacity = '0'; // 오전 글자 사라짐
         } else {
             // 오전 시간
-            if (bgAm) bgAm.style.opacity = '1';
-            if (bgPm) bgPm.style.opacity = '0';
-            
             if (ampmAm) ampmAm.style.opacity = '1'; // 오전 글자 나타남
             if (ampmPm) ampmPm.style.opacity = '0'; // 오후 글자 사라짐
         }
-    
+
         h = (h === 0 || h === 12) ? h : (h % 12);
-    
+
         const hStr = String(h).padStart(2, '0');
-    
+
         // --- 각 숫자에 페이드 효과 적용 ---
         updateElementWithFade('h1', hStr[0]);
         updateElementWithFade('h2', hStr[1]);
         updateElementWithFade('m1', m[0]);
         updateElementWithFade('m2', m[1]);
         updateElementWithFade('s1', s[0]);
         updateElementWithFade('s2', s[1]);
     }
 
         setInterval(updateClock, 1000);
         updateClock();
 
         // UI 컨트롤
         const breathing = document.getElementById('crossfade-bg'); 
         const wrapper = document.getElementById('clock-wrapper');
         const sizeRange = document.getElementById('sizeRange');
         const xRange = document.getElementById('xRange');
         const yRange = document.getElementById('yRange');
 
         function addMultiListener(element, events, func) { events.split(' ').forEach(e => element.addEventListener(e, func)); }
         function updateTransform() {
             const x = xRange.value; const y = yRange.value; const scale = sizeRange.value;
             wrapper.style.left = x + '%'; wrapper.style.top = y + '%';
             wrapper.style.transform = `translate(-50%, -50%) scale(${scale})`;
             breathing.style.left = x + '%'; breathing.style.top = y + '%';
            breathing.style.transform = `translate(-50%, -50%) scale(${scale})`;
        }
        addMultiListener(sizeRange, 'input change', updateTransform);
        addMultiListener(xRange, 'input change', updateTransform);
        addMultiListener(yRange, 'input change', updateTransform);

        const controls = document.getElementById('controls');
        const menuBtn = document.getElementById('menu-btn');
        let isMenuOpen = false;
        function toggleMenu() {
            isMenuOpen = !isMenuOpen;
            if (isMenuOpen) { controls.style.display = 'block'; menuBtn.style.display = 'none'; }
            else { controls.style.display = 'none'; menuBtn.style.display = 'block'; }
        }
        menuBtn.addEventListener('click', toggleMenu);
        menuBtn.addEventListener('touchstart', (e) => { e.preventDefault(); toggleMenu(); });

        const noSleep = new NoSleep();
        const wakeBtn = document.getElementById('wake-btn');
        let isWakeLockOn = false;
        function toggleNoSleep() {
            if (!isWakeLockOn) { noSleep.enable(); isWakeLockOn = true; wakeBtn.classList.add('active'); wakeBtn.innerText = "화면 켜짐 유지 (ON)"; }
            else { noSleep.disable(); isWakeLockOn = false; wakeBtn.classList.remove('active'); wakeBtn.innerText = "화면 켜짐 유지 (OFF)"; }
        }
    </script>
</body>
</html> 
